           <!-- Main Header -->
<style>.user-avatar {
    width: 50px; /* Chiều rộng giới hạn */
    height: 50px; /* Chiều cao giới hạn */
    object-fit: cover; /* Đảm bảo ảnh không bị méo */
    border-radius: 50%; /* Nếu muốn ảnh tròn */
}
</style>

        <header class="main-header flex">
            <!-- Header Lower -->
            <div id="header">
                <div class="header-lower">
                    <div class="tf-container full">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="inner-container flex justify-space align-center">
                                    <!-- Logo Box -->
                                    <div class="mobile-nav-toggler mobie-mt mobile-button">
                                        <i class="icon-Vector3"></i>
                                    </div>
                                    <div class="logo-box">
                                        <div class="logo">
                                            <a href="/">
                                                <img src="/global/assets/images/logo.png" alt="Logo">
                                            </a>
                                        </div>
                                    </div>
                                    <div class="header-account flex align-center">
                                        <div class="user-area">
                                            <ul class="flex align-center">
                                                <li id="user-menu">
                                                    <!-- Nội dung sẽ được cập nhật bằng JavaScript -->
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <img src="/global/assets/images/page/fl1.png" alt="" class="fly-ab">
                </div>
            </div>

            <!-- End Header Lower -->
            <a href="#" class="header-sidebar flex-three" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
                <i class="icon-Bars"></i>
            </a>

        </header>
        <!-- End Main Header -->

<!-- Header Script -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const userMenu = document.getElementById('user-menu');
    
        // Lấy dữ liệu từ localStorage
        const token = localStorage.getItem('token');
        const user = localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null;
    
        if (token && user) {
            const { user_id, role } = user; // Lấy thông tin user_id và role
    
            // Gọi API để lấy đường dẫn ảnh đại diện
            fetch(`/api/users/image/${user_id}`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch user image');
                    }
                    return response.json();
                })
                .then((data) => {
                    const avatarUrl = data.profile_picture; // Đường dẫn ảnh trả về từ API
                    const profileUrl = getProfilePage(role); // Lấy URL trang tài khoản dựa trên role
    
                    // Hiển thị thông tin người dùng với avatar và menu dropdown
                    userMenu.innerHTML = `
                        <div class="dropdown">
                            <a class="dropdown-toggle flex align-center" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <img src="${avatarUrl}" alt="Avatar" class="user-avatar">
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li><a class="dropdown-item" href="${profileUrl}">Tài khoản</a></li>
                                <li><a class="dropdown-item" id="logout" href="#">Đăng xuất</a></li>
                            </ul>
                        </div>
                    `;
    
                    // Thêm sự kiện xử lý đăng xuất
                    document.getElementById('logout').addEventListener('click', () => {
                        localStorage.removeItem('token'); // Xóa token khỏi localStorage
                        localStorage.removeItem('user'); // Xóa thông tin user khỏi localStorage
                        window.location.href = '/login'; // Chuyển hướng đến trang đăng nhập
                    });
                })
                .catch((error) => {
                    console.error('Error fetching user image:', error);
                    // Hiển thị mặc định nút đăng nhập nếu không lấy được ảnh
                    userMenu.innerHTML = `
                        <a href="/login" class="login-btn flex align-center">
                            <span>Đăng nhập</span>
                        </a>
                    `;
                });
        } else {
            // Nếu không có dữ liệu đăng nhập, hiển thị nút Đăng nhập
            userMenu.innerHTML = `
                <a href="/login" class="login-btn flex align-center">
                    <span>Đăng nhập</span>
                </a>
            `;
        }
    
        // Hàm lấy URL trang tài khoản dựa trên vai trò
        function getProfilePage(role) {
            switch (role) {
                case 'admin':
                    return '/admin';
                case 'host':
                    return '/host';
                default:
                    return '/user/profile';
            }
        }
    });
    
</script>

